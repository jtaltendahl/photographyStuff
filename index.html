<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Night Master Pro</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: #e0e0e0; padding: 20px; display: flex; justify-content: center; }
        .card { background: #1a1a1a; padding: 25px; border-radius: 16px; border: 1px solid #333; width: 100%; max-width: 400px; }
        h2 { color: #ffcc00; margin-top: 0; text-align: center; font-size: 1.2em; letter-spacing: 1px; }
        label { display: block; margin-bottom: 6px; font-weight: bold; font-size: 0.75em; color: #777; text-transform: uppercase; }
        select { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid #444; border-radius: 8px; background: #222; color: #ffcc00; font-size: 1.1em; cursor: pointer; -webkit-appearance: none; }
        .film-select { border: 1px solid #ffcc00; background: #2d2d14; color: #fff; font-weight: bold; }
        .btn-group { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; }
        button { padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 1em; cursor: pointer; }
        .calc-btn { background: #ffcc00; color: black; }
        .clear-btn { background: #333; color: #999; }
        .result-box { margin-top: 25px; padding: 20px; background: #222; border-radius: 10px; border-left: 5px solid #ffcc00; display: none; }
        .val-big { color: #00ff88; font-size: 2.2em; font-weight: bold; display: block; margin: 5px 0; }
        .val-small { color: #ffcc00; font-weight: bold; }
        .stat-row { display: flex; justify-content: space-between; font-size: 0.9em; margin-top: 10px; }
        .info { font-size: 0.7em; color: #555; text-align: center; margin-top: 20px; line-height: 1.4; }
    </style>
</head>
<body>

<div class="card">
    <h2>FILM NIGHT MASTER</h2>
    
    <label>Select Film Stock</label>
    <select id="filmSelect" class="film-select">
        <option value="1.35">Kodak Portra 400</option>
        <option value="1.53">Kodak Tri-X 400</option>
        <option value="1.28">Kodak T-Max 400</option>
    </select>

    <label>Shadow Reading (1° Spot)</label>
    <select id="shadowSelect"></select>

    <label>Highlight Reading (1° Spot)</label>
    <select id="highSelect"></select>

    <div class="btn-group">
        <button class="calc-btn" onclick="calculate()">CALCULATE</button>
        <button class="clear-btn" onclick="clearAll()">CLEAR</button>
    </div>

    <div id="results" class="result-box">
        <span style="font-size: 0.8em; color: #888;">FINAL EXPOSURE TIME:</span>
        <span id="finalVal" class="val-big">0.0s</span>
        
        <div class="stat-row">
            <span>Base (-2 stops):</span>
            <span id="baseVal" class="val-small">0s</span>
        </div>
        <div class="stat-row">
            <span>Contrast Range:</span>
            <span id="stopDiff" class="val-small">0 stops</span>
        </div>
        <div id="recipNote" style="font-size: 0.75em; color: #ff6b6b; margin-top: 10px; font-style: italic;"></div>
    </div>

    <div class="info">
        Calculations include 2-stop shadow placement<br>
        and film-specific reciprocity formulas.
    </div>
</div>

<script>
function getSpeeds() {
    let s = [
        { l: "1/8000", v: 1/8000 }, { l: "1/4000", v: 1/4000 }, { l: "1/2000", v: 1/2000 },
        { l: "1/1000", v: 1/1000 }, { l: "1/500", v: 1/500 }, { l: "1/250", v: 1/250 },
        { l: "1/125", v: 1/125 }, { l: "1/60", v: 1/60 }, { l: "1/30", v: 1/30 },
        { l: "1/15", v: 1/15 }, { l: "1/8", v: 1/8 }, { l: "1/4", v: 1/4 },
        { l: "1/2", v: 0.5 }, { l: "1\"", v: 1 }, { l: "2\"", v: 2 },
        { l: "4\"", v: 4 }, { l: "8\"", v: 8 }, { l: "15\"", v: 15 },
        { l: "30\"", v: 30 }, { l: "45\"", v: 45 }, { l: "60\"", v: 60 }
    ];
    for (let i = 75; i <= 180; i += 15) {
        let mins = Math.floor(i / 60);
        let secs = i % 60;
        let label = secs === 0 ? mins + "m" : mins + "m " + secs + "s";
        s.push({ l: label, v: i });
    }
    return s;
}

function populate() {
    const sSelect = document.getElementById('shadowSelect');
    const hSelect = document.getElementById('highSelect');
    const speeds = getSpeeds();
    const def = document.createElement('option');
    def.text = "-- Select Speed --"; def.value = "";
    sSelect.add(def.cloneNode(true)); hSelect.add(def);

    speeds.forEach(sp => {
        let o = document.createElement('option');
        o.value = sp.v; o.text = sp.l;
        sSelect.add(o.cloneNode(true)); hSelect.add(o);
    });
}

// NEW: Function to convert decimals to standard camera fractions
function formatTime(val) {
    if (val >= 1) {
        if (val < 60) return val.toFixed(1) + "s";
        let m = Math.floor(val / 60);
        let s = Math.round(val % 60);
        return s === 0 ? m + "m" : m + "m " + s + "s";
    }
    
    // For fractional seconds, find the closest standard shutter speed
    const standardFractions = [2, 4, 8, 15, 30, 60, 125, 250, 500, 1000, 2000, 4000, 8000];
    let denominator = 1 / val;
    let closest = standardFractions.reduce((prev, curr) => 
        Math.abs(curr - denominator) < Math.abs(prev - denominator) ? curr : prev
    );
    
    return "1/" + closest;
}

function calculate() {
    const tShad = parseFloat(document.getElementById('shadowSelect').value);
    const tHigh = parseFloat(document.getElementById('highSelect').value);
    const exponent = parseFloat(document.getElementById('filmSelect').value);
    
    if (isNaN(tShad)) return;

    // 1. Shadow Placement (-2 stops)
    let tBase = tShad / 4;
    document.getElementById('baseVal').innerText = formatTime(tBase);

    // 2. Reciprocity Logic
    let tFinal = tBase;
    let isRecip = false;

    if (tBase >= 1) {
        tFinal = Math.pow(tBase, exponent);
        isRecip = true;
    }
    
    document.getElementById('finalVal').innerText = formatTime(tFinal);
    document.getElementById('recipNote').innerText = isRecip ? "+ Reciprocity Applied" : "No adjustment needed";

    // 3. Contrast Calculation
    if (!isNaN(tHigh)) {
        let diff = Math.log2(tShad / tHigh);
        document.getElementById('stopDiff').innerText = diff.toFixed(1) + " stops";
    }

    document.getElementById('results').style.display = 'block';
}

function clearAll() {
    document.getElementById('shadowSelect').selectedIndex = 0;
    document.getElementById('highSelect').selectedIndex = 0;
    document.getElementById('results').style.display = 'none';
}

populate();
</script>
</body>
</html>
